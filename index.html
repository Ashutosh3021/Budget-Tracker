<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Budget Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
        }

        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            background-image: 
                linear-gradient(45deg, #10b981 25%, transparent 25%),
                linear-gradient(-45deg, #10b981 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #10b981 75%),
                linear-gradient(-45deg, transparent 75%, #10b981 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header h1 {
            font-size: clamp(1.8rem, 5vw, 3rem);
            margin-bottom: 10px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            letter-spacing: -1px;
        }

        .header p {
            color: #9ca3af;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
        }

        .badge-display {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .badge {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            padding: 10px 20px;
            border-radius: 25px;
            color: #6b7280;
            font-size: clamp(0.8rem, 1.5vw, 0.9rem);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .badge i {
            font-size: 1.2em;
        }

        .badge.earned {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            color: white;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
            animation: badgePulse 2s infinite;
        }

        @keyframes badgePulse {
            0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.5); }
        }

        .wizard, .dashboard {
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            border-radius: 24px;
            padding: clamp(20px, 5vw, 50px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid #2a2a2a;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .wizard-step {
            display: none;
        }

        .wizard-step.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #1a1a1a;
            border-radius: 10px;
            margin-bottom: 40px;
            overflow: hidden;
            border: 1px solid #2a2a2a;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .wizard-step h2 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: 25px;
            color: #10b981;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #d1d5db;
            font-weight: 600;
            font-size: clamp(0.9rem, 2vw, 1rem);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        label i {
            color: #10b981;
        }

        input, select {
            width: 100%;
            padding: 14px 18px;
            background: #0a0a0a;
            border: 2px solid #2a2a2a;
            border-radius: 12px;
            font-size: clamp(0.9rem, 2vw, 1rem);
            color: #e0e0e0;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            background: #0f0f0f;
        }

        input::placeholder {
            color: #4b5563;
        }

        .category-item {
            display: grid;
            grid-template-columns: 1fr 1fr auto auto;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #0a0a0a;
            border-radius: 12px;
            border: 1px solid #2a2a2a;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .category-item:hover {
            border-color: #10b981;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);
        }

        .remove-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .add-category-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-size: clamp(0.9rem, 2vw, 1rem);
            margin-top: 15px;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .add-category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 140px;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: clamp(0.9rem, 2vw, 1rem);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary {
            background: #1a1a1a;
            color: #e0e0e0;
            border: 2px solid #2a2a2a;
        }

        .btn-secondary:hover {
            background: #2a2a2a;
            transform: translateY(-2px);
        }

        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .dashboard h2 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            margin-bottom: 30px;
            color: #10b981;
            font-weight: 700;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid #2a2a2a;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.2);
            border-color: #10b981;
        }

        .stat-card h3 {
            font-size: clamp(0.8rem, 1.5vw, 0.9rem);
            color: #9ca3af;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-card .value {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            font-weight: bold;
            color: #10b981;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid #2a2a2a;
            transition: all 0.3s ease;
            width: 100%;
            overflow: hidden;
        }

        .chart-card:hover {
            border-color: #10b981;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.15);
        }

        .chart-card h3 {
            margin-bottom: 20px;
            color: #e0e0e0;
            font-size: clamp(1rem, 2vw, 1.2rem);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-card h3 i {
            color: #10b981;
        }

        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 75%;
        }

        .chart-wrapper canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
        }

        .expense-tracker {
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
            border: 1px solid #2a2a2a;
        }

        .expense-tracker h3 {
            margin-bottom: 20px;
            color: #e0e0e0;
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .expense-tracker h3 i {
            color: #10b981;
        }

        .expense-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }

        .expense-form .btn-primary {
            grid-column: span 1;
        }

        .expense-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .expense-list::-webkit-scrollbar {
            width: 8px;
        }

        .expense-list::-webkit-scrollbar-track {
            background: #0a0a0a;
            border-radius: 10px;
        }

        .expense-list::-webkit-scrollbar-thumb {
            background: #10b981;
            border-radius: 10px;
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px;
            background: #0a0a0a;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid #2a2a2a;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease-out;
        }

        .expense-item:hover {
            border-color: #10b981;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);
        }

        .expense-item .info {
            flex: 1;
        }

        .expense-item .info strong {
            color: #10b981;
            font-size: clamp(0.95rem, 2vw, 1.05rem);
        }

        .expense-item .info .description {
            font-size: clamp(0.85rem, 1.5vw, 0.9rem);
            color: #6b7280;
            margin-top: 4px;
        }

        .expense-item .info .date {
            font-size: clamp(0.75rem, 1.5vw, 0.8rem);
            color: #4b5563;
            margin-top: 4px;
        }

        .expense-item .amount {
            font-weight: bold;
            color: #e0e0e0;
            margin-right: 15px;
            font-size: clamp(1rem, 2vw, 1.1rem);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1a1a1a;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            max-width: 400px;
            animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #2a2a2a;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.show {
            display: flex;
            align-items: start;
            gap: 12px;
        }

        .toast.warning {
            border-left: 4px solid #ef4444;
        }

        .toast.success {
            border-left: 4px solid #10b981;
        }

        .toast i {
            font-size: 1.5em;
            margin-top: 2px;
        }

        .toast.warning i {
            color: #ef4444;
        }

        .toast.success i {
            color: #10b981;
        }

        .warning-card {
            background: linear-gradient(135deg, #451a03 0%, #292524 100%);
            border-left: 4px solid #f59e0b;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.3); }
            50% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); }
        }

        .warning-card h4 {
            color: #fbbf24;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: clamp(1rem, 2vw, 1.1rem);
        }

        .warning-card p {
            color: #d1d5db;
            margin: 8px 0;
            font-size: clamp(0.9rem, 1.5vw, 0.95rem);
        }

        .review-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: #0a0a0a;
            border-radius: 10px;
            margin-bottom: 12px;
            border: 1px solid #2a2a2a;
            transition: all 0.3s ease;
        }

        .review-item:hover {
            border-color: #10b981;
            transform: translateX(5px);
        }

        .review-item .label {
            color: #9ca3af;
            font-size: clamp(0.9rem, 1.5vw, 0.95rem);
        }

        .review-item .value {
            font-weight: bold;
            color: #10b981;
            font-size: clamp(0.95rem, 1.5vw, 1rem);
        }

        .distribution-info {
            background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
            padding: 20px;
            border-radius: 12px;
            margin-top: 25px;
            border: 1px solid #10b981;
        }

        .distribution-info h4 {
            color: #10b981;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: clamp(1rem, 2vw, 1.1rem);
        }

        .distribution-info p {
            color: #d1fae5;
            margin-bottom: 10px;
            font-size: clamp(0.9rem, 1.5vw, 0.95rem);
        }

        .distribution-info ul {
            margin-top: 12px;
            margin-left: 20px;
            color: #d1fae5;
        }

        .distribution-info li {
            margin: 8px 0;
            font-size: clamp(0.85rem, 1.5vw, 0.9rem);
        }

        .reset-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: clamp(0.9rem, 2vw, 1rem);
        }

        .reset-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.4);
        }

        @media (max-width: 768px) {
            .category-item {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .expense-form {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }

            .toast {
                left: 20px;
                right: 20px;
                max-width: calc(100% - 40px);
            }

            body {
                padding: 10px;
            }
        }

        @media (max-width: 480px) {
            .badge-display {
                gap: 8px;
            }

            .badge {
                padding: 8px 14px;
                font-size: 0.8rem;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state i {
            font-size: 4em;
            color: #374151;
            margin-bottom: 20px;
        }

        .empty-state p {
            font-size: clamp(0.9rem, 2vw, 1rem);
        }
    </style>
</head>
<body>
    <div class="background-pattern"></div>
    
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-wallet"></i> Student Budget Tracker</h1>
            <p>Master your money, maximize your future</p>
            <div class="badge-display" id="badgeDisplay"></div>
        </div>

        <div class="wizard" id="wizard">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="wizard-step active" data-step="1">
                <h2><i class="fas fa-hand-holding-usd"></i> Step 1: Monthly Pocket Money</h2>
                <div class="form-group">
                    <label for="monthlyIncome">
                        <i class="fas fa-rupee-sign"></i>
                        How much pocket money do you get monthly?
                    </label>
                    <input type="number" id="monthlyIncome" placeholder="Enter amount in ₹" min="0">
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="nextStep()">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <div class="wizard-step" data-step="2">
                <h2><i class="fas fa-list-ul"></i> Step 2: Expense Categories</h2>
                <p style="margin-bottom: 20px; color: #9ca3af;">Add your expense categories and estimated monthly amounts</p>
                <div id="categoriesContainer"></div>
                <button class="add-category-btn" onclick="addCategory()">
                    <i class="fas fa-plus-circle"></i> Add Category
                </button>
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-primary" onclick="nextStep()">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <div class="wizard-step" data-step="3">
                <h2><i class="fas fa-clipboard-check"></i> Step 3: Review & Auto-Distribution</h2>
                <div id="reviewContainer"></div>
                <div class="distribution-info">
                    <h4><i class="fas fa-lightbulb"></i> Smart Distribution Applied</h4>
                    <p>Your budget has been automatically distributed based on category importance:</p>
                    <ul>
                        <li><strong>Essentials (50%):</strong> Food, Transport, Study Materials</li>
                        <li><strong>Lifestyle (30%):</strong> Entertainment, Shopping, Others</li>
                        <li><strong>Savings (20%):</strong> Emergency fund & goals</li>
                    </ul>
                </div>
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-primary" onclick="nextStep()">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <div class="wizard-step" data-step="4">
                <h2><i class="fas fa-piggy-bank"></i> Step 4: Set Your Savings Goal</h2>
                <div class="form-group">
                    <label for="savingsGoal">
                        <i class="fas fa-bullseye"></i>
                        What are you saving for?
                    </label>
                    <input type="text" id="savingsGoal" placeholder="e.g., New phone, Trip, Emergency fund">
                </div>
                <div class="form-group">
                    <label for="targetAmount">
                        <i class="fas fa-coins"></i>
                        Target Amount (₹)
                    </label>
                    <input type="number" id="targetAmount" placeholder="How much do you want to save?" min="0">
                </div>
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-primary" onclick="completeBudget()">
                        <i class="fas fa-rocket"></i> Start Tracking!
                    </button>
                </div>
            </div>
        </div>

        <div class="dashboard" id="dashboard">
            <h2><i class="fas fa-chart-line"></i> Your Budget Dashboard</h2>
            
            <div id="warningContainer"></div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3><i class="fas fa-wallet"></i> Monthly Income</h3>
                    <div class="value" id="statIncome">₹0</div>
                </div>
                <div class="stat-card">
                    <h3><i class="fas fa-shopping-cart"></i> Total Spent</h3>
                    <div class="value" id="statSpent">₹0</div>
                </div>
                <div class="stat-card">
                    <h3><i class="fas fa-money-bill-wave"></i> Remaining</h3>
                    <div class="value" id="statRemaining">₹0</div>
                </div>
                <div class="stat-card">
                    <h3><i class="fas fa-chart-pie"></i> Savings Progress</h3>
                    <div class="value" id="statSavings">0%</div>
                </div>
            </div>

            <div class="expense-tracker">
                <h3><i class="fas fa-receipt"></i> Track Daily Expenses</h3>
                <div class="expense-form">
                    <input type="number" id="expenseAmount" placeholder="Amount (₹)" min="0">
                    <select id="expenseCategory"></select>
                    <input type="text" id="expenseDescription" placeholder="Description (optional)">
                    <button class="btn btn-primary" onclick="addExpense()">
                        <i class="fas fa-plus"></i> Add Expense
                    </button>
                </div>
                <div class="expense-list" id="expenseList"></div>
            </div>

            <div class="charts-container">
                <div class="chart-card">
                    <h3><i class="fas fa-chart-pie"></i> Category Spending</h3>
                    <canvas id="pieChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3><i class="fas fa-chart-bar"></i> Budget Remaining by Category</h3>
                    <canvas id="barChart"></canvas>
                </div>
            </div>

            <button class="reset-btn" onclick="resetBudget()">
                <i class="fas fa-redo"></i> Reset Budget
            </button>
        </div>

        <div class="toast" id="toast"></div>
    </div>

    <script>
        let currentStep = 1;
        let budgetData = {
            income: 0,
            categories: [],
            expenses: [],
            savingsGoal: '',
            targetAmount: 0,
            startDate: null,
            monthlyHistory: []
        };

        let pieChart, barChart;

        const essentialCategories = ['Food', 'Transport', 'Study Materials'];
        const lifestyleCategories = ['Entertainment', 'Shopping', 'Others'];

        function loadData() {
            const saved = localStorage.getItem('studentBudget');
            if (saved) {
                try {
                    budgetData = JSON.parse(saved);
                    if (budgetData.startDate) {
                        showDashboard();
                    }
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            }
        }

        function saveData() {
            try {
                localStorage.setItem('studentBudget', JSON.stringify(budgetData));
            } catch (e) {
                console.error('Error saving data:', e);
                showToast('Error saving data. Your browser storage might be full.', 'warning');
            }
        }

        function nextStep() {
            if (currentStep === 1) {
                const income = parseFloat(document.getElementById('monthlyIncome').value);
                if (!income || income <= 0) {
                    showToast('Please enter a valid amount!', 'warning');
                    return;
                }
                budgetData.income = income;
                initializeCategories();
            } else if (currentStep === 2) {
                const categories = collectCategories();
                if (categories.length === 0) {
                    showToast('Please add at least one category!', 'warning');
                    return;
                }
                budgetData.categories = categories;
                showReview();
            } else if (currentStep === 3) {
                applyAutoDistribution();
            }

            currentStep++;
            updateWizard();
            saveData();
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateWizard();
            }
        }

        function updateWizard() {
            document.querySelectorAll('.wizard-step').forEach(step => {
                step.classList.remove('active');
            });
            const activeStep = document.querySelector(`[data-step="${currentStep}"]`);
            if (activeStep) {
                activeStep.classList.add('active');
            }
            
            const progress = (currentStep / 4) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function initializeCategories() {
            const container = document.getElementById('categoriesContainer');
            container.innerHTML = '';
            
            const defaultCategories = [
                { name: 'Food', type: 'essential' },
                { name: 'Transport', type: 'essential' },
                { name: 'Entertainment', type: 'lifestyle' },
                { name: 'Study Materials', type: 'essential' }
            ];
            
            defaultCategories.forEach(cat => {
                addCategory(cat.name, cat.type);
            });
        }

        function addCategory(name = '', type = 'essential') {
            const container = document.getElementById('categoriesContainer');
            const div = document.createElement('div');
            div.className = 'category-item';
            div.innerHTML = `
                <input type="text" placeholder="Category name" value="${name}" class="category-name">
                <input type="number" placeholder="Amount (₹)" min="0" class="category-amount">
                <select class="category-type">
                    <option value="essential" ${type === 'essential' ? 'selected' : ''}>Essential</option>
                    <option value="lifestyle" ${type === 'lifestyle' ? 'selected' : ''}>Lifestyle</option>
                </select>
                <button class="remove-btn" onclick="this.parentElement.remove()">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(div);
        }

        function collectCategories() {
            const items = document.querySelectorAll('.category-item');
            const categories = [];
            
            items.forEach(item => {
                const name = item.querySelector('.category-name').value.trim();
                const amount = parseFloat(item.querySelector('.category-amount').value) || 0;
                const type = item.querySelector('.category-type').value;
                
                if (name && amount > 0) {
                    categories.push({ name, amount, type, spent: 0 });
                }
            });
            
            return categories;
        }

        function showReview() {
            const container = document.getElementById('reviewContainer');
            let html = '<h3>Your Budget Summary</h3>';
            
            html += `<div class="review-item">
                <span class="label"><i class="fas fa-wallet"></i> Monthly Income:</span>
                <span class="value">₹${budgetData.income.toFixed(0)}</span>
            </div>`;
            
            let totalPlanned = 0;
            budgetData.categories.forEach(cat => {
                totalPlanned += cat.amount;
                const icon = cat.type === 'essential' ? 'fas fa-check-circle' : 'fas fa-star';
                html += `<div class="review-item">
                    <span class="label"><i class="${icon}"></i> ${cat.name} (${cat.type}):</span>
                    <span class="value">₹${cat.amount.toFixed(0)}</span>
                </div>`;
            });
            
            const remaining = budgetData.income - totalPlanned;
            html += `<div class="review-item" style="border-top: 2px solid #10b981; margin-top: 10px; padding-top: 15px;">
                <span class="label"><i class="fas fa-piggy-bank"></i> Planned Savings:</span>
                <span class="value" style="color: ${remaining >= 0 ? '#10b981' : '#ef4444'}">₹${remaining.toFixed(0)}</span>
            </div>`;
            
            container.innerHTML = html;
        }

        function applyAutoDistribution() {
            const income = budgetData.income;
            const essentialBudget = income * 0.5;
            const lifestyleBudget = income * 0.3;
            const savingsBudget = income * 0.2;
            
            let essentialCount = budgetData.categories.filter(c => c.type === 'essential').length;
            let lifestyleCount = budgetData.categories.filter(c => c.type === 'lifestyle').length;
            
            if (essentialCount === 0) essentialCount = 1;
            if (lifestyleCount === 0) lifestyleCount = 1;
            
            budgetData.categories = budgetData.categories.map(cat => {
                if (cat.type === 'essential') {
                    cat.budget = essentialBudget / essentialCount;
                } else {
                    cat.budget = lifestyleBudget / lifestyleCount;
                }
                return cat;
            });
            
            budgetData.suggestedSavings = savingsBudget;
        }

        function completeBudget() {
            const goal = document.getElementById('savingsGoal').value.trim();
            const target = parseFloat(document.getElementById('targetAmount').value) || 0;
            
            if (!goal) {
                showToast('Please enter what you\'re saving for!', 'warning');
                return;
            }
            
            budgetData.savingsGoal = goal;
            budgetData.targetAmount = target;
            budgetData.startDate = new Date().toISOString();
            budgetData.expenses = budgetData.expenses || [];
            
            saveData();
            showDashboard();
            showToast('Budget setup complete! Start tracking your expenses', 'success');
        }

        function showDashboard() {
            document.getElementById('wizard').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            
            populateExpenseCategories();
            updateDashboard();
            initCharts();
            checkBadges();
        }

        function populateExpenseCategories() {
            const select = document.getElementById('expenseCategory');
            if (budgetData.categories && budgetData.categories.length > 0) {
                select.innerHTML = budgetData.categories.map(cat => 
                    `<option value="${cat.name}">${cat.name}</option>`
                ).join('');
            }
        }

        function addExpense() {
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const category = document.getElementById('expenseCategory').value;
            const description = document.getElementById('expenseDescription').value.trim();
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount!', 'warning');
                return;
            }
            
            if (!category) {
                showToast('Please select a category!', 'warning');
                return;
            }
            
            const expense = {
                amount,
                category,
                description,
                date: new Date().toISOString()
            };
            
            budgetData.expenses.push(expense);
            
            const cat = budgetData.categories.find(c => c.name === category);
            if (cat) {
                cat.spent = (cat.spent || 0) + amount;
            }
            
            saveData();
            updateDashboard();
            
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDescription').value = '';
            
            checkOverspending(category, amount);
            checkPredictions();
            checkBadges();
            
            showToast(`Added ₹${amount} to ${category}`, 'success');
        }

        function checkOverspending(category, amount) {
            const cat = budgetData.categories.find(c => c.name === category);
            if (!cat) return;
            
            const percentUsed = (cat.spent / cat.budget) * 100;
            
            if (cat.type === 'lifestyle' && amount > 500) {
                const messages = [
                    `₹${amount} on ${category}? Your future self just facepalmed`,
                    `Wow, ₹${amount} for ${category}. Living the high life, aren't we?`,
                    `₹${amount} on ${category}? Hope it was worth the instant noodles later`,
                    `${category} for ₹${amount}? Bold move. Your wallet is crying`,
                    `₹${amount}? Someone's feeling fancy today. Budget says hi from the corner`
                ];
                setTimeout(() => {
                    showToast(messages[Math.floor(Math.random() * messages.length)], 'warning');
                }, 300);
            }
            
            if (percentUsed > 80 && percentUsed <= 100) {
                setTimeout(() => {
                    showToast(`You've used ${percentUsed.toFixed(0)}% of your ${category} budget. Easy there!`, 'warning');
                }, 600);
            } else if (percentUsed > 100) {
                setTimeout(() => {
                    showToast(`Uh oh! You've exceeded your ${category} budget by ₹${(cat.spent - cat.budget).toFixed(0)}`, 'warning');
                }, 600);
            }
        }

        function checkPredictions() {
            const today = new Date();
            const startDate = new Date(budgetData.startDate);
            const daysElapsed = Math.max(1, Math.floor((today - startDate) / (1000 * 60 * 60 * 24)));
            const daysInMonth = 30;
            
            const totalSpent = budgetData.expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const dailyAverage = totalSpent / daysElapsed;
            const projectedSpending = dailyAverage * daysInMonth;
            
            const percentOfMonth = (daysElapsed / daysInMonth) * 100;
            const percentSpent = (totalSpent / budgetData.income) * 100;
            
            const warnings = [];
            
            if (percentSpent > percentOfMonth + 20 && daysElapsed > 3) {
                warnings.push({
                    title: 'Spending Too Fast!',
                    icon: 'fas fa-exclamation-triangle',
                    message: `You've spent ${percentSpent.toFixed(0)}% of your budget in ${percentOfMonth.toFixed(0)}% of the month.`,
                    prediction: `At this rate, you'll spend ₹${projectedSpending.toFixed(0)} this month (${((projectedSpending/budgetData.income)*100).toFixed(0)}% of income).`
                });
            }
            
            if (projectedSpending > budgetData.income && daysElapsed > 3) {
                const daysUntilBroke = Math.floor(budgetData.income / dailyAverage);
                warnings.push({
                    title: 'Money Running Out Alert!',
                    icon: 'fas fa-fire',
                    message: `Your current spending pattern suggests you'll run out of money by day ${daysUntilBroke} of the month.`,
                    prediction: 'Consider cutting back on non-essential spending immediately!'
                });
            }
            
            const warningContainer = document.getElementById('warningContainer');
            if (warnings.length > 0) {
                warningContainer.innerHTML = warnings.map(w => `
                    <div class="warning-card">
                        <h4><i class="${w.icon}"></i> ${w.title}</h4>
                        <p>${w.message}</p>
                        <p><strong>${w.prediction}</strong></p>
                    </div>
                `).join('');
            } else {
                warningContainer.innerHTML = '';
            }
        }

        function updateDashboard() {
            const totalSpent = budgetData.expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const remaining = budgetData.income - totalSpent;
            const savingsProgress = budgetData.targetAmount > 0 ? 
                Math.min(100, (remaining / budgetData.targetAmount) * 100) : 0;
            
            document.getElementById('statIncome').textContent = `₹${budgetData.income.toFixed(0)}`;
            document.getElementById('statSpent').textContent = `₹${totalSpent.toFixed(0)}`;
            document.getElementById('statRemaining').textContent = `₹${remaining.toFixed(0)}`;
            document.getElementById('statSavings').textContent = `${savingsProgress.toFixed(0)}%`;
            
            updateExpenseList();
            updateCharts();
        }

        function updateExpenseList() {
            const list = document.getElementById('expenseList');
            const expenses = [...budgetData.expenses].reverse();
            
            if (expenses.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>No expenses yet. Start tracking!</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = expenses.map((exp, index) => {
                const cat = budgetData.categories.find(c => c.name === exp.category);
                const icon = cat && cat.type === 'essential' ? 'fas fa-check-circle' : 'fas fa-star';
                
                return `
                    <div class="expense-item">
                        <div class="info">
                            <strong><i class="${icon}"></i> ${exp.category}</strong>
                            ${exp.description ? `<div class="description">${exp.description}</div>` : ''}
                            <div class="date"><i class="far fa-calendar"></i> ${new Date(exp.date).toLocaleDateString()}</div>
                        </div>
                        <span class="amount">₹${exp.amount.toFixed(0)}</span>
                        <button class="remove-btn" onclick="removeExpense(${budgetData.expenses.length - 1 - index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            }).join('');
        }

        function removeExpense(index) {
            if (index < 0 || index >= budgetData.expenses.length) return;
            
            const expense = budgetData.expenses[index];
            const cat = budgetData.categories.find(c => c.name === expense.category);
            if (cat) {
                cat.spent = Math.max(0, (cat.spent || 0) - expense.amount);
            }
            
            budgetData.expenses.splice(index, 1);
            saveData();
            updateDashboard();
            checkBadges();
            
            showToast('Expense removed', 'success');
        }

        function initCharts() {
            const pieCtx = document.getElementById('pieChart');
            const barCtx = document.getElementById('barChart');
            
            if (!pieCtx || !barCtx) return;
            
            pieChart = new Chart(pieCtx.getContext('2d'), {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#10b981', '#059669', '#34d399', '#6ee7b7',
                            '#a7f3d0', '#d1fae5', '#f59e0b', '#f97316'
                        ],
                        borderColor: '#1a1a1a',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e0e0e0',
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1a1a1a',
                            titleColor: '#10b981',
                            bodyColor: '#e0e0e0',
                            borderColor: '#2a2a2a',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ₹${context.parsed.toFixed(0)}`;
                                }
                            }
                        }
                    }
                }
            });
            
            barChart = new Chart(barCtx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Remaining Budget',
                        data: [],
                        backgroundColor: '#10b981',
                        borderColor: '#059669',
                        borderWidth: 1
                    }, {
                        label: 'Spent',
                        data: [],
                        backgroundColor: '#ef4444',
                        borderColor: '#dc2626',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                color: '#2a2a2a'
                            },
                            ticks: {
                                color: '#9ca3af'
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            grid: {
                                color: '#2a2a2a'
                            },
                            ticks: {
                                color: '#9ca3af',
                                callback: function(value) {
                                    return '₹' + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e0e0e0',
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1a1a1a',
                            titleColor: '#10b981',
                            bodyColor: '#e0e0e0',
                            borderColor: '#2a2a2a',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ₹${context.parsed.y.toFixed(0)}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateCharts() {
            if (!pieChart || !barChart) return;
            
            const categories = budgetData.categories;
            const labels = categories.map(c => c.name);
            const spent = categories.map(c => c.spent || 0);
            const remaining = categories.map(c => Math.max(0, (c.budget || 0) - (c.spent || 0)));
            
            pieChart.data.labels = labels;
            pieChart.data.datasets[0].data = spent;
            pieChart.update();
            
            barChart.data.labels = labels;
            barChart.data.datasets[0].data = remaining;
            barChart.data.datasets[1].data = spent;
            barChart.update();
        }

        function checkBadges() {
            const totalSpent = budgetData.expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const remaining = budgetData.income - totalSpent;
            const savingsPercent = (remaining / budgetData.income) * 100;
            
            const badges = [
                { name: 'Saver Novice', icon: 'fas fa-seedling', earned: savingsPercent >= 5, threshold: 5 },
                { name: 'Budget Master', icon: 'fas fa-gem', earned: savingsPercent >= 20, threshold: 20 },
                { name: 'Savings Champion', icon: 'fas fa-trophy', earned: savingsPercent >= 30, threshold: 30 }
            ];
            
            const badgeDisplay = document.getElementById('badgeDisplay');
            badgeDisplay.innerHTML = badges.map((badge, idx) => `
                <div class="badge ${badge.earned ? 'earned' : ''}" title="${badge.earned ? 'Unlocked!' : `Save ${badge.threshold}% to unlock`}">
                    <i class="${badge.icon}"></i>
                    ${badge.name}
                    ${!badge.earned ? `<span style="opacity: 0.7; font-size: 0.85em">(${badge.threshold}%)</span>` : ''}
                </div>
            `).join('');
            
            badges.forEach((badge, index) => {
                const badgeKey = `badge${index}Shown`;
                if (badge.earned && !budgetData[badgeKey]) {
                    setTimeout(() => {
                        showToast(`Achievement Unlocked: ${badge.name}!`, 'success');
                    }, 500);
                    budgetData[badgeKey] = true;
                    saveData();
                }
            });
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
            
            toast.innerHTML = `
                <i class="${icon}"></i>
                <div>${message}</div>
            `;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 5000);
        }

        function resetBudget() {
            if (confirm('Are you sure you want to reset your budget? All data will be lost!')) {
                localStorage.removeItem('studentBudget');
                location.reload();
            }
        }

        // Initialize on load
        loadData();
    </script>
</body>
</html>